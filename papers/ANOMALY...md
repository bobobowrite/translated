# 基于Web攻击的异常检测

Gustavo Miguel Barroso Assis do Nascimento

MESTRADO EM SEGURANÇA INFORMÁTICA

November 2010

## 摘要

要成功阻止攻击, 建立一个全面和精准的检测系统是至关重要的.
基于特征的入侵检测系统(IDS)是其中最为流行的一种方法,
但是对于基于Web的攻击或者新型攻击的检测, 这些方法还不够令人满意.
本项目的目标是研究和设计一种能够检测这类攻击的异常入侵检测系统.

基于异常的 IDS 可以从一组训练数据中创建一个正常行为模型，然后用它来检
测新的攻击. 在大多数情况下，该模型表示的实例多于训练数据集中的实例，这
就是我们所指的泛化特征，也是准确异常检测所必需的. 此类系
统的准确性在很大程度上受到模型构建阶段(通常称为训练)的影响，模型构建
阶段取决于拥有不受攻击的数据，类似于受保护应用程序的正常操作. 拥有良好
的模型尤为重要，否则 IDS 可能会在检测阶段产生大量误报和漏报.

本论文详细介绍了我们关于使用基于异常的方法来检测对 Web 服务器和应用程
序的攻击的研究. 我们的贡献集中在三个不同的方面: i）高级训练程序, 即使
在复杂和动态的 Web 应用程序的情况下, 也能使基于异常的学习系统表现良好;
ii) 一个包含多种异常检测技术的系统，能够发现和鉴别针对 Web 服务器
和应用程序的攻击, 以及 iii) 使用来自部署于托管在葡萄牙 ISP 的生产服务器中的大
型 Web 应用程序的大量真实流量, 对系统和最适合的 Web 攻击异常检测的技术的使用进行了评估.

关键词: 异常检测 入侵检测 web攻击 计算机 网络

## 1 介绍

自从计算机存在以来，计算机网络就一直不停地增长和发展.
众所周知, 计算机网络已经成为银行、保险、军事等各个领域的大多数企业和组织发展的必备工具.
几个系统和网络之间的互连使得它们和大量的不断增长的多元化用户群体联通.
这些已知和未知的用户, 在访问这些网络时并不总是怀着善意. 
他们可以尝试读取、修改或破坏关键信息，或者只是攻击和扰乱系统. 
由于这些网络可能成为攻击的潜在目标, 因此确保它们的安全是一个不容忽视的重要方面.
在过去的二十年中, 互联网上发生的计算机安全事件数量的增加反映了互联网本身的发展。

作为 Internet 增长的一个方面, 超文本传输协议(HTTP)这些年来已被广泛使用.
如今, 应用程序被设计作为 Web 服务运行, 使用 HTTP 作为其标准通信协议部署在 Internet 上.
Web 应用程序的成功和广泛接受所形成的一种趋势, 表明人们将在未来几年严重依赖 Web 应用程序.
此类 Web 应用程序的流行引起了试图利用其漏洞的攻击者的注意.
根据2005年 CSI/FBI 计算机犯罪和安全调查[1], 95%的受访组织报告说他们经历过10多起与其网站相关的安全事件.

此外, 正如 CVE 漏洞趋势[2]在五年内显示的那样, 公开报告的 Web 应用程序漏洞总数急剧上升, 
甚至超过了缓冲区溢出漏洞. 促成这一趋势的三种最典型的网络相关攻击是: 
SQL 注入, 跨站点脚本 (XSS) 和远程文件包含 (RFI).
这种趋势的主要原因可以解释为易于发现和利用 Web 漏洞, 以及由缺乏经验的开
发人员编写的低级软件应用程序的激增.
![figure1.1](./papers/figures/1.1.jpg)
图 1.1 显示了多年来攻击复杂程度与入侵者所需技术知识的演变，是这种趋势的有力证据。

入侵检测(ID)是指计算机系统通过分析安全相关事件自动判断安全破坏事件的能力.
入侵检测系统(IDS)长期以来一直是理论研究和开发的课题,
并随着企业向互联网转移许多关键业务而获得主流关注.
这样的技术可以帮助提醒安全管理员实时发生在他们的系统和网络上的可疑活动.
入侵检测系统(IDS)通过检测入侵者, 可以在他们企图攻击或者入侵之前提供有关信息.

由于许多计算机系统基础设施容易受到攻击,
ID 成为了一个重要的技术业务部门.
作为一个活跃的研究领域[3], 可以帮助企业保持他们的系统, 进而他们的业务安全.
IDS 背后的主要思想是检测被监控资源的使用情况与正常行为的偏差.
考虑到当有人试图篡改系统时, 他/她将改变一些活动或者改变系统本身的参数, 
此类活动的结果应该偏离正常行为并因此被 IDS 检测到.

一个 IDS 可以根据几个特征进行分类, 例如,
其引擎分析的数据(主机/网络数据)种类及其检测异常的方式(签名或基于异常).
在这篇论文中, 我们特别关注的是检测针对 Web 服务器和应用程序的攻击时基于异常的 IDS, 
因为这些代表了当下涉及计算机网络相关安全问题的很大一部分.

为了检测已知的网络攻击，基于特征的 IDS 持有大量相关特征.
不幸的是, 它很难跟上网络漏洞的披露速度. 
因此, 基于特征的系统是不够的，应该加以补充基于异常检测的系统, 
这就是我们这项工作的主题.

### 1.1 动机和目标

基于异常的入侵检测系统有可能检测到新型的, 以前未知的攻击(也称为零day攻击).
然而, 这些系统通常会遭受高误报率, 并且可以通过模仿攻击(即试图作为正常行为通过的攻击的变体)来规避, 
例如通过使用字节替换和/或填充技术.
解决这些问题并提高基于异常的 IDS 的准确性的主要挑战之一在于控制模型的泛化.
基于异常的 IDS 从一组训练数据中学习并构建出正常行为模型.
正常行为是假定服务是根据其管理员的意图使用的, 换句话说, 它假设不存在攻击.

创建模型后, 后续观察到的偏离模型的情况被归类为异常.
为了实现不仅仅是简单地记住训练数据, 
基于异常的 IDS 必须泛化.
通过泛华, 基于异常的 IDS 接受与训练数据集相似但不一定相同的输入, 
这意味着被视为正常的实例集将是比训练数据中的实例集更大的集合.

泛化不足的异常检测系统会产生过多的误报, 而泛化过度的异常检测系统会漏报攻击.
因此, 正确的泛化是基于异常的 IDS 提高准确性的必要条件.

我们在研究中明确解决的另一个主要挑战是模型创建阶段(通常称为训练)对系统整体检测准确性的重大影响.
此阶段取决于用于模拟受保护系统或应用程序正常活动的流量或数据的质量,
这些流量或数据里应该免除利用了尚未公开的软件漏洞的零day攻击.

在本论文中, 我们提出了一种算法来清洗(即消除攻击)从网络流量中收集的 Web 请求数据集, 
以使其适合训练异常检测系统. 
此过程的主要目标是使基于异常的系统能够使用不包含攻击的输入数据构建其统计模型.

我们研究的另一个目标是设计一个基于异常的入侵检测系统, 该系统包含多种异常检测技术, 
可以基于区分正常请求和异常请求的模型来识别针对Web 服务器和应用程序的攻击.

作为我们研究的最终和主要目标, 我们使用生产环境大规模部署的一个web应用程序的真实流量
评估了基于异常的 IDS 的使用情况以及它包括的每一种异常检测技术的准确性.

### 1.2 论文概述

在第2章中, 我们通过讨论入侵检测将我们的工作置于研究背景中, 提供入侵检测系统
的分类及其作用和要求. 
然后我们讨论万维网 (WWW) 和超文本传输协议 (HTTP) 协议以及针对它的典型攻击类别.
接下来, 我们将讨论与使用 HTTP 协议攻击的异常检测相关的潜在问题.
总而言之, 我们介绍之前在基于Web 的攻击的异常检测领域的工作.

第3章详细介绍了我们对基于异常的 IDS 的使用研究, 其中用以研究的数据来自
于生成环境大规模部署的一个Web应用程序. 
我们讨论泛化的概念及其在异常检测中的重要性, 并解释应如何创建模型.

接下来, 我们提出了一种算法, 可用于清洗请求数据集,
以消除其中包含的攻击，以便它可用于训练异常检测系统.

此外, 我们解释了如何使用相似性度量来检测异常, 然后描述了先前文献中建议的九种不同算法来检
测网络流量中的异常, 讨论它们的优点和局限性.
进一步, 我们展示了我们基于异常的 IDS, 设计包含了所有这些算法以及我们使用的泛化启发式算法.

第4章介绍了我们的实验结果和对 Web 攻击异常检测算法的评估.
我们解释了我们如何获得和定义我们的数据集, 并简要说明我们的 IDS 是如何工作的.

然后我们根据每个模型所需的空间, 创建模型(训练)的运行时间以及使用它来测试异常(检测)来描述需求.
最后, 我们通过讨论每个模型的结果以及说明和比较它们之间的检测精度来分析每个模型.

在第5章中, 我们总结并指出了我们研究过程中遇到的一些问题, 强调了我们的贡献并讨论了未来的工作.

### 1.3 术语

在本文中, 首字母缩略词 IDS(入侵检测系统)以单数和复数形式使用, 以识别
基于网络(NIDS)和基于主机(HIDS)的入侵检测系统. 当指的是针对使用
HTTP 协议的万维网服务器或应用程序的请求或攻击时, 术语 web 和 http 可以互换使用.

## 2 上下文和相关工作

在本章中, 我们讨论入侵检测, 介绍定义, 评估方法, 并提出入侵检测系统的分类来概述其作用和必要条件.
然后我们讨论万维网和 HTTP 协议, Web漏洞以及针对 Web 服务器和应用程序的典型攻击类别.
接下来, 我们讨论与使用 HTTP 协议攻击的异常检测相关的潜在问题.
总而言之，我们陈述之前的在基于web的攻击的异常检测领域工作.

### 2.1 入侵检测

在讨论入侵检测之前, 我们必须定义什么是入侵.
入侵是相对于安全策略定义的,
它定义了对于一个系统什么是允许的什么是拒绝的.
除非你知道你的系统允许什么或不允许什么, 
否则尝试检测入侵意义不大.

**入侵**的定义是一组尝试危及某种资源的完整性, 机密性, 或可用性的行为[4].

**入侵检测**的定义是识别和响应针对计算和网络资源恶意行为的过程[5].

**入侵检测系统**则是监控计算机系统和/或网络活动以识别
恶意或可疑事件(即入侵). 
每当发生这样的事件时, IDS 会发出警报.

#### 2.1.1 评估

为了评估 IDS，我们首先需要选择好的度量指标来
能够确定其质量和检测能力.
然后我们需要在一些之前收集好的数据上运行它, 比如 DARPA
1999 IDS 数据集 [6], 
这是用以评估 IDS 的最流行的公开可用数据集.
IDS 的模型可以通过使用不同数据源的数据创建,
例如捕获网络数据包, 或者应用程序日志文件中的数据项,
这些都可以看作是IDS 的对象.

IDS 将判断每一个数据对象是否是攻击.
在基于特征的 IDS 中, 判断是根据 IDS 规则集数据库中存在的特征做出的，
而基于异常的 IDS 判断是依赖统计模型做出的.
无论哪种情况, IDS 都会将每个数据对象标记为正常或者攻击.
因此, 评估 IDS 背后的主要思想是鉴定有多少这样的数据对象被正确和错误地标记了.

为了评估 IDS 系统的质量, 我们首先需要定义一些条目.
当 IDS 在检测网络流量或事件时, 它试图判断流量或事件是否是恶意的.
当 IDS 指出一个入侵, 称之为Positive.
如果相应的警报确实是一个真正的入侵企图, 那么我们有一个True Positive (TP), 
即来自 IDS 的阳性断言是可信的, 因为这是一个正确的断言.

然而, IDS 可以即使没有发生攻击也报告入侵.
在这种情况下, 我们有所谓的误报(FP).
定义(True Positive)真阳性是真实的警报, 是对入侵企图的响应.
这表明入侵检测系统精确地检测到了一个特定的攻击.

**定义(False Positive)**误报是一个错误的警报, 是对非恶意行为响应, 即在没有发生攻击的情况下被 IDS 识别为入侵的错误事件.
表示尽管没有发生真正的攻击, 入侵检测系统却检测到攻击.
另一方面, 如果 IDS 指明流量或事件是无害, 这叫一个negative.
当 IDS 指明没有入侵而这是一个正确的断言时, 称为True Negative(TN).
相反的, 当 IDS 没有指出入侵, 但实际存在入侵行为时, 我们有一个False Negative (FN).

**定义(True Negative)**是当没有入侵行为发生时也没有警报的事件.
这表明入侵检测系统没有错误地检测正常情况.

**定义(False Negative)**是当一个真正的入侵行为发生时没有入侵警报发出的事件,
即当入侵发生时 IDS 无法识别的事件.

**定义 IDS 的(True Positive Rate)**真阳性率(TPR)或的检测率(DR)为: TPR = TP/(TP +FN)
其中 TP 是真阳性的数量，FN 是假阴性的数量.
完美的 IDS 是使得 TPR = 1.
TPR衡量了恶意事件被正确识别和报告的数量.

**定义(False Positive Rate)**误报率为: FPR = FP/(FP+TN).
其中 FP 是误报数，TN 是
真阳性的数量.
误报率 (FPR) 衡量的是被错误分类和报告为入侵的合法事件的量。

#### 2.1.2 ROC曲线

接受者操作特征(ROC)曲线通常用于评估 IDS 的质量
(参见[7]和[8]有关更多关于 ROC 曲线分析信息).

ROC曲线是对信号检测器准确性的二维描述, 它产生于一组给定的测试数据.
需要两个维度来展示真阳性检测率随着假阳性率的增加而降低的整个过程.
ROC曲线的目的是表明相应信号检测器的精度. 

以曲线形状展示的精度信息是二维的, 这是因为有两种事件，因此有两种
可能的准确性.

第一个维度是检测信号事件的成功率, 沿y轴显示(纵轴).
第二个维度是错误识别噪声事件的错误率, 沿x轴显示(横轴).

因为成功是好的, 错误是坏的, 
一个好的ROC曲线的y值应该以比x值其更快的速率增长, 从而曲线形状迅速抬升.

之后, 随着决策门槛的变得越来越放宽, 噪声的误差值(x值)也必须
变大, 赶上信号的成功值(y值).
这使得曲线向右弯曲, 直到它触及点(0,1)[7]。

The ROC curve for an IDS is basically the plot between the TPR and
the FPR rates as the threshold value is varied, in order to show the
tradeoff between them. It is obtained by tuning the IDS to tradeoff
false positives (FP) against true positives (TP), where each point
of the ROC curve corresponds to a fixed amount of TPR and FPR
calculated under certain sensitivity parameters (threshold). The ROC
curve provides a compact and easy way to visually understand how the
tradeoff varies for different values of the threshold. The way ROC
curves indicate the accuracy of the detector, is by the rise of the
curve.
In Figure 2.1, (a) shows a perfect ROC curve that passes through the
point (0,1) while a ROC curve no better than chance lies along the
positive diagonal. Shown in 2.1 (b), each point along the ROC curve
corresponds to a different threshold. Points closer to the origin (0,
0) indicate a more exclusive criterion; points closer to the
upper-right (1,0) indicate a more inclusive one (source [7]).

![](./papers/figures/2.1.jpg)
